<!--# include file="_start.html" -->
<h1><span>О проекте</span></h1>
<div class="block">
	<p><strong>CBSD</strong>&nbsp;&mdash; это обёртка из&nbsp;<strong>sh</strong>-скриптов (преимущественно) вокруг подсистемы <a href="http://www.freebsd.org/cgi/man.cgi?query=jail&sektion=8" target="_blank">jail(8)</a> операционной системы <a href="http://www.freebsd.org" target="_blank">FreeBSD</a>, ориентированного на&nbsp;связывание различных особенностей FreeBSD, таких как racct, vnet, zfs, carp, hastd и&nbsp;так далее&nbsp;в&nbsp;один инструмент для более комплексного решения при построении серверов приложений, использующее заранее подготовленные jail-образы с&nbsp;типовым набором&nbsp;ПО и&nbsp;требующие минимальной настройки.</p>
	<p>Благодаря простоте базового функционала по&nbsp;созданию и&nbsp;удалению клеток (и&nbsp;я&nbsp;надеюсь, он&nbsp;таким и&nbsp;останется), в&nbsp;данный момент существует множество реализаций и&nbsp;надстроек над стандартным <a href="http://www.freebsd.org/cgi/man.cgi?query=jail&sektion=8" target="_blank">jail(8)</a>, позволяя людям создавать и&nbsp;использовать собственные варианты по&nbsp;управлению jail, и&nbsp;<strong>CBSD</strong> является одним из&nbsp;них.</p>
	<p>Какого-либо нового функционала в&nbsp;ОС на&nbsp;данном этапе не&nbsp;внесено&nbsp;&mdash; всё, что могут делать скрипты <strong>CBSD</strong>, можно сделать командой (командами, десятками, сотнями команд) в&nbsp;CLI через соответствующие утилиты. Проект делается как для облегчения собственных нужд по&nbsp;администрированию клеток и&nbsp;серверов, так и &laquo;just for fun&raquo;.</p>
	<p>Из&nbsp;списка собственных нужд можно отметить следующие возможности:</p>
	<ul>
		<li>быстрое развертывание jail с&nbsp;нуля;</li>
		<li>эспорт и&nbsp;импорт jail в&nbsp;образ;</li>
		<li>клонирование и/или миграция jail (в&nbsp;т.ч. на&nbsp;удалённую машину);</li>
		<li>снапшоты jail;</li>
		<li>подсчёт трафика и&nbsp;потребляемых ресурсов на&nbsp;один jail;</li>
		<li>управление ресурсами jail (приоритезация (re-nice), RACCT/RCTL, файловые квоты);</li>
		<li>репликация jail на&nbsp;удалённые машины;</li>
		<li>дистрибьюция &laquo;типовых&raquo; jail, клеток с&nbsp;определённым набором софта и&nbsp;сервисами;</li>
		<li>WEB-интерфейс и&nbsp;централизованное управление фермой jail-ов;</li>
		<li>&hellip;</li>
	</ul>
</div>
<h2><a name="why">Пара ПОЧЕМУ&hellip;</a></h2>
<div class="block">
	<p>&laquo;Почему FreeBSD, почему Jail, почему&nbsp;sh, почему &hellip;&raquo;:</p>
	<p>FreeBSD/jail выбраны для проекта по&nbsp;ряду причин, наиболее важные из&nbsp;которых:</p>
	<ul>
		<li>Отсутствие у&nbsp;Jail накладных ресурсов на&nbsp;виртуализацию. Без VIMAGE, код jail до&nbsp;сих пор имеет в&nbsp;ядре крайне мало своих if/case конструкций;</li>
		<li>Следование совету безопасников&nbsp;&mdash; &laquo;разделяй и&nbsp;властвуй&raquo;. Желательно каждый сервис или группу сервисов изолировать от&nbsp;других;</li>
		<li>Системным инженерам зачастую приходится делать массу однотипных инсталляций&nbsp;&mdash; AMP, MTA, KDE4, &hellip; в&nbsp;какой-то момент захотелось иметь заранее сформированное и&nbsp;настроенное окружение. Клеточный подход позволяет ввести сервер в&nbsp;экслуатацию мгновенно, после установки FreeBSD с&nbsp;нуля&nbsp;&mdash; для того, чтобы развернуть почтовый сервер или запустить KDE4, никаких настроек в&nbsp;мастер хосте делать не&nbsp;нужно&nbsp;&mdash; достаточно скачать заранее сформированное окружение по&nbsp;сети. Возможности создавать Desktop клетки имеют свою особую прелесть в&nbsp;виде остутствия в&nbsp;необходимости создавать 1024-ый по&nbsp;счёту дистрибутив, отличающийся от&nbsp;других только картинкой рабочего стола и&nbsp;набором ПО;</li>
		<li>Удобство бекапа и&nbsp;раскатывания клетки на&nbsp;свежеустановленную ноду;</li>
		<li>Построение собственных локальный репозиториев/библиотек клеток с&nbsp;кастомизированными опциями через <a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/ports.html" target="_blank">FreeBSD ports</a>;</li>
		<li>При вышеупомянутом плюсе&nbsp;&mdash; отсутствие оверхеда на&nbsp;виртуализацию с&nbsp;соответствующим мониторингом, можно формировать максимально эффективные системы. Например, имеются клетки с&nbsp;NoSQL (Redis, Memcached)&nbsp;&mdash; плотная работа с&nbsp;памятью, клетка с&nbsp;MySQL&nbsp;&mdash; плотная работа с&nbsp;CPU, клетка с&nbsp;WEB-скриптами (CPU&amp;сеть), клетка с&nbsp;Samba (нагрузка на&nbsp;сеть и&nbsp;диски)&hellip; Каждую физическую ноду можно укомплектовать такими Jail, с&nbsp;которыми не&nbsp;будет простаивать ни&nbsp;один из&nbsp;аппаратных компонентов сервера и&nbsp;при этом клетки не&nbsp;будут друг другу мешать.</li>
		<li>Не очень приятно жить в мире, в котором есть один только Linux</li>
		<li>&hellip;</li>
	</ul>
	<p>Большая часть кода написана на&nbsp;<strong>sh</strong>&nbsp;по&nbsp;той причине, что подобные задачи не&nbsp;требуют большой математической логики&nbsp;&mdash; скрипты в&nbsp;основном повторяют ввод команд системного администратора в&nbsp;консоли, то есть работают с&nbsp;внешними утилитами, такими как: <strong>zfs</strong>, <strong>zpool</strong>, <strong>sudo</strong>, <strong>pkg</strong>, <strong>rsync</strong>, соответственно, необходимость применять языки программирования по&nbsp;большей части отсутствует. Часть узких мест, а&nbsp;также некоторый функционал (logtail, репликация, демон следящий за&nbsp;нодами и&nbsp;тп) написаны на&nbsp;C (в&nbsp;планах переписывать узкие места на&nbsp;Си и&nbsp;дальше).</p>
	<p>CBSD зависит от&nbsp;следующего&nbsp;ПО: <strong>rsync</strong>, <strong>sudo</strong>, <strong>libssh2</strong>, <strong>sqlite3</strong></p>
</div>
<h2><a name="features">Особенности&hellip;</a></h2>
<div class="block">
	<ul>
		<li>готовый репозиторий для ядер и&nbsp;миров, что делает шаги <strong>buildworld/installworld</strong> необязательными;</li>
		<li>если шаги <strong>buildworld/installworld</strong> предпринимаются, поддерживается src.conf для кастомизации сборки;</li>
		<li>base каталог может располагаться на&nbsp;MD/RAM/TMPFS диске, что может быть полезно при большом кол-ве jail-ов с&nbsp;RO-подмонтированной базой;</li>
		<li>поддержка ZFS файловой системы, ZFS квот, ZFS снапшотов;</li>
		<li>GUI конфигуратор клеток (DIALOG/WEB);</li>
		<li>поддержка VIMAGE;</li>
		<li>подсчет трафика в&nbsp;jail;</li>
		<li>импортирование/экспортирование клеток;</li>
		<li>описания клеток;</li>
		<li>холодная миграция клетки с&nbsp;ноды на&nbsp;ноду;</li>
		<li>управление очередностью запуска jail и&nbsp;их&nbsp;приоритетом;</li>
		<li>поддержка RACCT/RCTL;</li>
		<li>репозиторий с&nbsp;готовыми template-клетками;</li>
		<li>репликация клетки;</li>
		<li>возможность создавать свои собственные сценарии для создания клеток;</li>
		<li>конвертирование jail в&nbsp;PXE/ISO/Memstick-имидж;</li>
		<li>поддержка ненативных архитектур клеток через Qemu User mode (например, клетки arm и&nbsp;mips64 архитектуры на&nbsp;x86-64&nbsp;ноде);</li>
		<li>&hellip;</li>
	</ul>
</div>
<h2><a name="goals">Цели проекта</a></h2>
<div class="block">
	<ul>
		<li>автоматизация типовых операций;</li>
		<li>удобный менеджмент, мониторинг и&nbsp;контроль за клетками;</li>
		<li>создание платформы для приложений по-требованию;</li>
		<li>библиотека образов;</li>
		<li>и&nbsp;не&nbsp;только&hellip;</li>
	</ul>
</div>
<!--# include file="_end.html" -->