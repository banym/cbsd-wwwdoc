	<h1><span>CREATING JAILS</span></h1>
	
	<h2><a name="jcreate_cmd">commands: jcreate, jconstruct-tui</a></h2>
	<div class="block">
		<pre class="brush:bash;ruler=true;">
		% cbsd jconstruct-tui
		</pre>
		<pre class="brush:bash;ruler=true;">
		% cbsd jcreate jconf=/path/to/conf.jconf
		</pre>
	</div>
	<div class="block">
		<strong>Description</strong>:
		<p>The jail is created according to configuration file generated by <strong>cbsd jcreate jconf=path_to_cfg</strong>. For create configuration, use a command <strong>cbsd jconstruct</strong> (question-answer dialog mode), or <a href="http://man.freebsd.org/dialog/1" target="_blank">dialog(1)</a>-based interface: <strong>cbsd jconstruct-tui</strong>, or via WEB interface. When <a href="https://wiki.freebsd.org/pkgng" target="_blank"><strong>pkg.conf</strong></a> and repository configured properly, you can preset to new jail some packages mark them through <strong>pkglist</strong> menu. For safety reason recommended to use the official FreeBSD <strong>pkg</strong> repo or  <strong>build your own</strong> package repository.</p>
		<p>Please note: when repo unavailable, item <strong>pkglist</strong> in <strong>cbsd jconstruct-tui</strong> did not show anything.</p>
		<p>Please note: multi-repo and and the ability to choose a specific repository from the list at the moment is missing, and will be used repository prescribed in pkg.conf of master host.</p>
	</div>
	<div class="warning">
		<p style="color:RED">Attention! Because the list and choose of packages formed by pkg.conf of master machine, keep in mind that the content of the selected packages on the list will only work if the architecture and version of the jail equal with master node</p>
	</div>
	<div class="block">
		<p>for creating config via dialog:</p>
		<pre class="brush:bash;ruler=true;">
			% cbsd jconstruct-tui
		</pre>
		<p>If <strong>jconstruct-tui</strong> work correctly, on the exit the question for jail create will be asked. In a case positively answer, <strong>jcreate</strong> it will be executed on a new configuration automatically. Otherwise, the script will save configuration file (in <em>$workdir/ftmp</em>), on which it is possible to create a jail by hand.</p>
	</div>
	<!--# include file="/en/changeroot.html" -->
	<div class="block">
		<p>You can override the <strong>jailskeldir</strong>="$workdir/share/jail-skel", parameters which is stored in <em>$workdir/etc/defaults/jail-freebsd-default.conf</em> to specify an alternate template directory, which will overwrite the files in the original base files when creating jail. To do this, create a file <strong>jail-freebsd-XXXXX.conf</strong> in <em>$workdir/etc</em> and enter the value, for example:</p>
		<pre class="brush:bash;ruler=true;">
			jailskeldir="/root/share/jail-skel"
		</pre>
		<p>Setting default values for dialog and for the parameters for <a href="http://man.freebsd.org/jail/8" target="_blank">jail(8)</a> when creating .jconf (unless overridden in the dialog) are described in the profile file <em>$workdir/etc/defaults/jail-freebsd-default.conf</em>.
		<p>You can create custom profiles for their defaults, by creating files with similar contents and putting them in files named <strong>jail-freebsd-XXXX.conf</strong> in <em>$workdir/etc</em> directory. Furthermore, through the value of the parameter <strong>$jail_profile</strong> in jail-freebsd-default.conf you can specify your profile instead of default. For example, if you want to default <strong>astart</strong> mattered 0, <strong>vimage</strong> was enabled, suggest jail name instead of <strong>jail1, jail2, jail3</strong> as <strong>client1, client2, client3</strong> and <strong>exec_start</strong> instead of the standard value <strong>/bin/sh /etc/rc</strong> was set to <strong>/bin/date</strong>, with this profile should be offered by default, create jail-freebsd-default.conf in <em>$workdir/etc</em> directory which will overwrite default_profile.</p>
		<p>And among other things, for a group of jail of <strong>myhosting</strong> profile, when you start jail, link the MySQL database files are located in the appropriate jail of the client (to a client database influenced ZFS quota for jail) in MySQL engine which is running on master node, and when you stop jails -- then unlink</p>
		<pre class="brush:bash;ruler=true;">
			% echo default_profile="myhosting" > /usr/jails/etc/jail-freebsd-default.conf
		</pre>
		<p>then create your profile file, give it a name (myhosting in our example) and override values you need. for example <em>/usr/jails/etc/jail-freebsd-myhosting.conf</em> might look like:</p>
		<pre class="brush:bash;ruler=true;">
			jail_profile="myhosting"
			jailskeldir="$workdir/share/jail-skel"
			astart="0"
			exec_start="/bin/date"
			vimage="1"
			default_jailname="client"
			exec_master_poststop="rm -f /var/db/mysql/${jname}";
			exec_master_prestart="ln -sfh ${workdir}/jails-data/${jname}-data/var/db/mysql/${jname} /var/db/mysql/${jname}";
		</pre>
	</div>
	<h2><a name="jcreate_cmd">DIALOG MENU OPTIONS</a></h2>
	<div class="block">
	<ul>
		<li>profile - profile in which the parameters are set by default. Described above</li>
		<li>pkglist - Select package list for new jail</li>
		<li>jname - Short (one word) name of the jail</li>
		<li>host_hostname - FQDN for the jail environment</li>
		<li>ip4_addr - specify IP addresses (separated by commas if more than one) or 0 for vnet/bhyve environments</li>
		<li>ver - FreeBSD version for the base (10.1, 11.0 for RELEASE or 10, 11 for STABLE)</li>
		<li>baserw - mount copy of base via nullfs in read only (baserw=no) or populate own copy (baserw=yes) with write access</li>
		<li>mount_ports - mount /usr/ports dir from base system to jail (read only). To the environment can build ports (and not interfere with each other vorkdir) - reassigned WRKDIRPREFIX parameters to alternate location. Or, make sure that applytpl params is set to 1 - then CBSD does this automatically via WRKDIRPREFIX=/tmp in /etc/make.conf of the jail</li>
		<li>astart - Automatic start jail on the system boot</li>
		<li>interface - Specify uplink for jail (on what interface create/remove IP) or prohibit.</li>
		<li>applytpl - Automatically adjust the same settings of the jail (create /etc/hosts, change WRKDIRPREFIX, etc..)</li>
		<li>floatresolv - Automatically adjust /etc/resolv.conf from jnameserver IP (settings from initenv/initenv-tui)</li>
		<li>arch - Specify architecture of jail environment</li>
		<li>vnet - Enable or disable VIMAGE feature</li>
	</ul>
	</div>
