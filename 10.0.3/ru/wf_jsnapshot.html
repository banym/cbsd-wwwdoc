<strong>Команды</strong>:<br>
<pre class="brush:bash;ruler:true;">
% cbsd jsnapshot
</pre>

<strong>Описание</strong>:
<br><br>
Выводит список, создает, удаляет и откатывает файловые снэпшоты для клетки, если нода запущена на файловой системе ZFS и <strong>zfsfeat</strong> в файле <strong>nc.inventory</strong> установлена в 1.
<br>
Через параметр <strong>mode</strong> указывается, что именно необходимо выполнить. Возможные варианты:
<br><br>
<strong>list</strong> - вывести список снапшотов для указанной клетки
<br>
<strong>create</strong> - создать снапшот для указанной клетки
<br>
<strong>destroy</strong> - удалить снапшот для указанной клетки
<br>
<strong>destroyall</strong> - удалить все снапшоты для указанной клетки
<br>
<strong>clone</strong> - клонировать снашпот для указанной клетки
<br>
<strong>rollback</strong> - откатить снапшот для указанной клетки
<br><br>
Дополнительные параметры:
<br><br>
<strong>jname</strong> - для какого jail выполняется действие
<br>
<strong>snapname</strong> - указать имя снапшота
<br>
<br><br>
Следует иметь ввиду, что снапшоты имеют древовидную структуру. Тоесть, если вы создали последовательно снапшоты: <strong>1,2,3,4</strong> и откатились на снапшот <strong>2</strong>, то снапшотов <strong>3</strong> и </strong>4</strong> не будет, поскольку по отношению
ко времени создания снапшота <strong>2</strong> они были созданы в будущем.
<br><br>
Кроме произвольного и уникального имени снапшота, при создании вы можете указать snapname=gettimeofday. В этом случае, система автоматически в качестве имени подставит timestamp от текущего времени.
<br><br>
При выводе списка снапшотов, вы можете пользоваться модификаторами для уточнения к какому jail вы хотите увидеть снапшоты, а также кастомизировать выводимые поля через аргумент <strong>display=</strong>
<br><br>
<strong>Пример</strong>:
<br><br>
создаем snapshot с именем <em>gromozeka</em> для клетки <strong>jail1</strong>:
<br>
<pre class="brush:bash;ruler:true;">
% cbsd jsnapshot mode=create jname=jail1 snapname=gromozeka
</pre>
создаем snapshot с именем <em>zelepuka</em> для клетки <strong>jail1</strong>:
<pre class="brush:bash;ruler:true;">
% cbsd jsnapshot mode=create jname=jail1 snapname=zelepuka
</pre>
<br>
Запустим jail1, выполним какие-либо модификации, остановим:
<pre class="brush:bash;ruler:true;">
% cbsd jstart jail1
..
% cbsd jexec jname=jail1 cp /bin/date /root
% cbsd jexec jname=jail1 file -s /root/date
/root/date: ELF 64-bit LSB executable, x86-64, version 1 (FreeBSD), dynamically linked (uses shared libs), for FreeBSD 9.0 (900506), stripped
% cbsd jstop jail1
..
</pre>
Откатим jail1 на состояние, когда был создан снапшот zelepuka:
<pre class="brush:bash;ruler:true;">
% cbsd jsnapshot mode=rollback snapname=zelepuka jname=jail1
% cbsd jstart jail1
...
% cbsd jexec jname=jail1 file -s /root/date
/root/date: ERROR: cannot open `/root/date' (No such file or directory)
</pre>

<br><center>
<img src="/html/img/jsnapshot1.png"></img>
<br><br>
<img src="/html/img/jsnapshot2.png"></img>
<br><br>
</center>
</p>
